---
title: "Verification of label transfer in ACC ALLEN DATA"
output: html_notebook
author: "MB"
---

# Load libraries

```{r message=FALSE, warning=FALSE}
library(pagoda2)
library(conos)
library(magrittr)
library(readr)
library(data.table)
library(ggplot2)
library(gridExtra)
library(pals)
library(viridis)
library(dplyr)
library(parallel)
library(patchwork)

```

# Some variables

```{r}
#palette
palette_45 <- c(
as.vector(polychrome(36)),
as.vector(alphabet(10))
)
```




# Load our schizo data
```{r tidy=TRUE}
con_acc <- read_rds("../ctx_layers_SCZ_ALLEN/rds_objects/acc_allen_only.con.rds")

annotations_acc_high <- read_rds("../ctx_layers_SCZ_ALLEN/rds_objects/acc_high_transf_annotations.rds")
annotations_acc_med <- read_rds("../ctx_layers_SCZ_ALLEN/rds_objects/acc_mid_transf_annotations.rds")
```


# Plots

## High res
```{r, fig.height = 11, fig.width = 12, message=F}
con_acc$plotGraph(alpha = 0.4, groups = annotations_acc_high$labels,
                  font.size = 4, mark.groups = T, size = 0.6,
                  show.legend = T, legend.pos = "bottom", 
#                  plot.na = F, keep.limits = T
#                  color.range = "data"
                  ) + scale_color_manual(values = palette_45[])
```

```{r, fig.height = 11, fig.width = 12, message=F}
con_acc$plotGraph(alpha = 0.4, groups = annotations_acc_high$labels[annotations_acc_high$labels == "SST_NPY"],
                  font.size = 1, mark.groups = T, size = 0.6,
                  show.legend = T, legend.pos = "bottom", 
                  plot.na = F, keep.limits = T
#                  color.range = "data"
                  ) + scale_color_manual(values = palette_45[-(1:7)])
```



## Mid res
```{r, fig.height = 11, fig.width = 12, message=F}
con_acc$plotGraph(alpha = 0.4, groups = annotations_acc_med$labels,
                  font.size = 4, mark.groups = T, size = 0.6,
                  show.legend = T, legend.pos = "bottom"
#                  color.range = "data"
                  ) + scale_color_manual(values = palette_45)
```



## Plot marker genes:

### Astrocytes
```{r fig.width=14, fig.height=18}

plot.list.scz.ast <- lapply(X = c("GFAP", "AQP4", "SLC1A3", "SLC1A2", "GJB6", "GLUL", "FGFR3", 
                                "ALDH1L1", "S100B", "ATP1B2"), function(x) {
  con_acc$plotGraph(gene = x, title = x, size = 0.3, alpha = 1)
}
)


grid.arrange(grobs = plot.list.scz.ast, ncol = 3)

#arrangeGrob(grobs = plot.list.Allen, nrow = 3)


```
### Oligos
```{r fig.width=14, fig.height=14}

plot.list.scz.olig <- lapply(X = c("MBP", "MOG", "MAG", "SOX10", "CNDP1", "OPALIN","MOBP"), function(x) {
  con_acc$plotGraph(gene = x, title = x)
}
)


grid.arrange(grobs = plot.list.scz.olig, ncol = 3)

#arrangeGrob(grobs = plot.list.Allen, nrow = 3)


```
### OPCs
```{r fig.width=14, fig.height=13}

plot.list.scz.opc <- lapply(X = c("CSPG4", "PDGFRA", "OLIG1", "OLIG2", "SOX10", "CSPG5", "PCDH15"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x)
}
)


grid.arrange(grobs = plot.list.scz.opc, ncol = 3)

#arrangeGrob(grobs = plot.list.Allen, nrow = 3)


```

**ISSUE: OPCs are picked as some VIP neurons: need to exclude those from analysis and map!!!!!!!**



### Microglia
```{r fig.width=14, fig.height=10}

plot.list.scz.u <- lapply(X = c("CX3CR1", "AIF1", "ITGAM", "CD68", "C3"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x)
}
)


grid.arrange(grobs = plot.list.scz.u, ncol = 3)

#arrangeGrob(grobs = plot.list.Allen, nrow = 3)


```

### Endothelial
```{r fig.width=14, fig.height=35}

plot.list.scz.end <- lapply(X = c("FLT1", "CD34", "PECAM1", "ICAM2", "TIE1", "CDH5", "CLDN5", "ADGRF5", "EMCN", "APLN", "CD82", "CHST1", "APOD", "VTN", "ATP13A5", "PTH1R", "TAGLN", "BMX", "LUM", "IL33", "CD93", "CLEC1A", "SLC16A1", "ITIH5", 
  "CXCL12"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x)
}
)


grid.arrange(grobs = plot.list.scz.end, ncol = 3)

#arrangeGrob(grobs = plot.list.Allen, nrow = 3)


```

### Pericyte
```{r fig.width=14, fig.height=22}

plot.list.scz.peri <- lapply(X = c("EMCN", "VTN", "CSPG4", "ATP13A5", "PTH1R", "KCNJ8", "ABCC9", "APLN", "CD82", "CHST1", "CLDN5", "ADGRF5", 
  "APOD", "IFITM1", "CASQ2"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x)
}
)


grid.arrange(grobs = plot.list.scz.peri, ncol = 3)

#arrangeGrob(grobs = plot.list.Allen, nrow = 3)


```

### Neurons general
```{r fig.width=14, fig.height=35}

plot.list.scz.neur <- lapply(X = c("SNAP25", "CELF4", "RBFOX3","SYT1", "SYP", "ROBO2", "SCN2A", "MEG3",
                                     "CAMK4", "GABRA1", 
                                     "SYNPR", "SCG2", "GAD1", "SLC32A1", "GABRB2", "CHGB",
                                     "CCK", "SLC17A7", "SLC17A6",  "SV2B", "TBR1", "CAMK2A", "SATB2", "RORB"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x)
}
)


grid.arrange(grobs = plot.list.scz.neur, ncol = 3)

#arrangeGrob(grobs = plot.list.Allen, nrow = 3)


```






### Plot excitatory
```{r fig.width=14, fig.height=72}
#Neurons excitatory markers
plot.list.scz.neur.exc <- lapply(X = c("CUX2", "LAMP5", "PDGFD", "MARCH1", "FREM3", "SV2C", "THEMIS", "SEMA3A",
                                          "FEZF2", "TLE4", "HTR2C", "ADRA1A", "ABO", "UNC5D", "RORB", "SCHLAP1",
                                          "ARHGAP15", "MET", "LRRK1", "MME", "PRSS12", "SCUBE1", "NTNG2"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha= 1, size = 0.3
                    )
}
)


grid.arrange(grobs = plot.list.scz.neur.exc, ncol = 2)

#arrangeGrob(grobs = plot.list.Allen, ncol = 3)


```


### Plot inhibitory
```{r fig.width=14, fig.height=72}
#Neurons excitatory markers
plot.list.scz.neur.inh <- lapply(X = c("PVALB", "CRH", "MEPE", "NOS1", "VIP", "ABI3BP", "RELN", "TYR", "ID2",
                                         "CRH", "SSTR1", "SEMA3C", "SST", "CALB1", "NMBR", "NCKAP5", "PAX6", "TH",
                                         "STK32A", "NPY", "TAC3", "LAMP5"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha = 1, size = 0.3)
}
)


grid.arrange(grobs = plot.list.scz.neur.inh, ncol = 2)

#arrangeGrob(grobs = plot.list.Allen, ncol = 3)


```

### Plot VIP + markers
```{r fig.width=14, fig.height=75}
#Neurons excitatory markers
plot.list.scz.vip_plus <- lapply(X = c("VIP", "RELN", "ABI3BP", "ADARB2", "CHRNA2", "NCKAP5", "TAC3", "LAMA3", 
                                       #"NRP3", 
                                       "KCNJ2", "CHRM2", "HS3ST3A1", "CRH", 
                                         "CCK", "IQGAP2", "TYR", "SEMA6A", "TOX2", "SEMA3C", "ADAMTSL1", "PENK", "CASC6", "PBX3", "SSTR1", "DPP6", "NCKAP5",
                                         "OPRM1"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha = 1, size = 0.3)
}
)


grid.arrange(grobs = plot.list.scz.vip_plus, ncol = 2)

#arrangeGrob(grobs = plot.list.Allen, ncol = 3)


```

### Plot VIP - markers
```{r fig.width=14, fig.height=67}
#Neurons excitatory markers
plot.list.scz.vip_minus <- lapply(X = c("PBX3", "CRH", "CCK", "SEMA6A", "TYR", "CASC6", "DPP6", "IQGAP2", "TOX2", "SEMA3C", "CHRM2", "NCKAP5",
                                       "CCK", "RELN", "TAC3", "LAMA3", 
                                       #"NRP3",
                                       "KCNJ2", "HS3ST3A1", "ABI3BP"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha = 1, size = 0.3)
}
)


grid.arrange(grobs = plot.list.scz.vip_minus, ncol = 2)

#arrangeGrob(grobs = plot.list.Allen, ncol = 3)


```





### Plot Id2 + markers
```{r fig.width=14, fig.height=110}
#Neurons excitatory markers
plot.list.scz.id2_plus <- mclapply(X = c("ID2", "LAMP5", "NOS1", "NMBR", "CRH", "NCKAP5", "COL5A2", "PAX6", "PDGFD", "ADGRG6", "LHX6", "CALB1", "FREM2", "PDGFRA", "CHST9",
                                       "NTNG1", "SV2C", "RELN", "SST", "PTPRT", "NXPH1", "GRIA4", "GRIN2A", "LCP2", "CHRNA7", "CDH12", "CALB2", "SYNPR", "DSCAM", "SPOCK1",
                                       "OXR1", "NRXN3", "NXPH1", "ADARB2", "BAGE2", "SCGN"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha = 1, size = 0.3)
}
)


grid.arrange(grobs = plot.list.scz.id2_plus, ncol = 2)

#arrangeGrob(grobs = plot.list.Allen, ncol = 3)


```





### Plot Id2 - markers
```{r fig.width=14, fig.height=21}
#Neurons excitatory markers
plot.list.scz.id2_minus <- mclapply(X = c("VIP", "NCKAP5", "CHRNA2", "NMBR", "LCP2"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha = 1, size = 0.3)
}
)


grid.arrange(grobs = plot.list.scz.id2_minus, ncol = 2)

#arrangeGrob(grobs = plot.list.Allen, ncol = 3)


```



### Plot SST + markers
```{r fig.width=14, fig.height=60}

plot.list.scz.sst_plus <- mclapply(X = c("SST", "TH", "TRHDE", "EPB41L4A", "GABRG3", "SASH1", "TAC3", "RELN", "FAM89A", "TRHDE",
                                         "STK32A", "GXYLT2", "NOS1", "ADGRG6", "FBN2", "CALB1", "HPGD", "STXBP6", "NPY"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha = 1, size = 0.3)
}
)


grid.arrange(grobs = plot.list.scz.sst_plus, ncol = 2)

#arrangeGrob(grobs = plot.list.Allen, ncol = 3)


```




### Plot SST - markers
```{r fig.width=14, fig.height=36}

plot.list.scz.sst_minus <- mclapply(X = c("PVALB", "VIP", "ID2", "LAMP5", "PAX6", "RELN", "FAM89A", "CALB1", "ADGRG1", "STK32A", "HPGD"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha = 1, size = 0.3)
}
)


grid.arrange(grobs = plot.list.scz.sst_minus, ncol = 2)

#arrangeGrob(grobs = plot.list.Allen, ncol = 3)


```

### Plot PVALB + markers
```{r fig.width=14, fig.height=35}

plot.list.scz.pvalb_plus <- mclapply(X = c("PVALB", "CRH", "NOG", "NOS1", "MEPE", "UNC5B", "NPNT", "CALB1", "SULF1"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha = 1, size = 0.3)
}
)


grid.arrange(grobs = plot.list.scz.pvalb_plus, ncol = 2)

#arrangeGrob(grobs = plot.list.Allen, ncol = 3)


```

### Plot PVALB - markers
```{r fig.width=14, fig.height=45}

plot.list.scz.pvalb_minus <- mclapply(X = c("SST", "VIP", "ID2", "LAMP5", "PAX6", "MEPE", "SULF1", "NOS1", "CRH", "NOG", "UNC5B", "NPNT", "CALB1"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha = 1, size = 0.3)
}
)


grid.arrange(grobs = plot.list.scz.pvalb_minus, ncol = 2)

#arrangeGrob(grobs = plot.list.Allen, ncol = 3)


```


### Plot Exc Cux + markers
```{r fig.width=14, fig.height=77}

plot.list.scz.cux_plus <- mclapply(X = c("CUX2", "LAMP5", "FREM3", "PDGFD", "SV2C", "PRSS12", "LTK", "GLP2R", "ABLIM1", "SHISA9",
                                         "MARCH1", "LTK", "SPOCK3", "ABLIM1", "LAMA2", "KAZN", "UNC5D", "NTNG1", "COBLL1", "DCC", "COL5A2"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha = 1, size = 0.3)
}
)


grid.arrange(grobs = plot.list.scz.cux_plus, ncol = 2)

#arrangeGrob(grobs = plot.list.Allen, ncol = 3)


```


### Plot Exc Cux - markers
```{r fig.width=14, fig.height=77}

plot.list.scz.cux_minus <- mclapply(X = c("RORB", "MARCH1", "LAMA2",  "DCC", "COBLL1", "COL5A2", "SPOCK3", "FREM3",  "PRSS12", "PDGFD", 
                                          "LAMP5", "SHISA9", "UNC5D", "NTNG1", "ABLIM1",  "SV2C", "KAZN", "GLP2R", "THEMIS", "TLE4", 
                                          "LTK", "GLP2R", "SCHLAP1"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha = 1, size = 0.3)
}
)


grid.arrange(grobs = plot.list.scz.cux_minus, ncol = 2)

#arrangeGrob(grobs = plot.list.Allen, ncol = 3)


```



### Plot Exc Rorb Themis + markers
```{r fig.width=14, fig.height=90}

plot.list.scz.rorb_themis_plus <- mclapply(X = c("RORB", "SCHLAP1", "MME", "TSHZ2", "COBLL1", "COL22A1", "DCSTAMP", "DAPK2", "INPP4B", "TPBG", "MET",
                                          "GABRG1", "ARHGAP15", "ADGRL4", "TLL1", "TPBG", "THEMIS", "GRIK3", "SEMA3A", "PXDN", "OPRK1", 
                                          "NR4A2", "NTNG2", "NTNG1", "POSTN", "SPOCK3"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha = 1, size = 0.3)
}
)


grid.arrange(grobs = plot.list.scz.rorb_themis_plus, ncol = 2)

#arrangeGrob(grobs = plot.list.Allen, ncol = 3)


```

### Plot Exc Rorb Themis - markers
```{r fig.width=14, fig.height=90}

plot.list.scz.rorb_themis_minus <- mclapply(X = c("CUX2", "TLE4", "ARSI", "CAMK2D", "PCP4", "FEZF2", "INPP4B", "TLL1", "MET", "TPBG", "GABRG1",
                                                  "ARSJ", "COL22A1", "DCSTAMP", "DAPK2", "MME", "TLE4", "RORB", "SCHLAP1", "NR4A2", "GRIN3A",
                                                  "POSTN", "HTR2C", "NXPH2", "GRIK3"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha = 1, size = 0.3)
}
)


grid.arrange(grobs = plot.list.scz.rorb_themis_minus, ncol = 2)

#arrangeGrob(grobs = plot.list.Allen, ncol = 3)


```


### Plot Exc Fezf + markers
```{r fig.width=14, fig.height=110}


plot.list.scz.fezf_plus <- mclapply(X = c("FEZF2", "LRRK1", "ADRA1A", "HTR2C", "IL26", "CARD11", "KCNIP1",
                                          "RORB", "ARSJ", "PCP4", "CAMK2D", "TLL1", "TSHZ2", "THEMIS", "TLE4", "GRIN3A", "SEMA3E", "NXPH2",
                                          "ABO", "SEMA5A", "SEMA5B", "LDB2", "SCUBE1", "NR4A2", "CDH10", "CNTN4", "SLC15A5", #"CCN2",
                                          "VAT1L", "PCSK6", "PQLC2L", "LINC00861"
                                          ),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha = 1, size = 0.3)
}
)


grid.arrange(grobs = plot.list.scz.fezf_plus, ncol = 2)



```



### Plot Exc Fezf - markers
```{r fig.width=14, fig.height=110}

plot.list.scz.fezf_minus <- mclapply(X = c("CUX2", "INPP4B", "COBLL1", "TPBG", "COL22A1", "MET", "MME", "TLE4", "RORB", "THEMIS", "LRRK1", "NR4A2",
                                           "PCSK6", "NTNG2", "NTNG1", "POSTN", "SPOCK3", "OPRK1", "ABO", "LINC00861", "HTR2C",
                                           "IL26", "CARD11", "CDH10", "CNTN4", "SLC15A5", "OPRK1", "GRIN3A", "TLL1", "KCNIP1", "NXPH2",
                                           "NR4A2", "POSTN", "SPOCK3", "LDB2", "SEMA5A", "SEMA5B", "POSTN"),
                               function(x) {
  con_acc$plotGraph(gene = x, title = x, alpha = 1, size = 0.3)
}
)


grid.arrange(grobs = plot.list.scz.fezf_minus, ncol = 2)

#arrangeGrob(grobs = plot.list.Allen, ncol = 3)


```



